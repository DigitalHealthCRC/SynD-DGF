<!-- Assessment Outcomes Integration Component -->
<!-- Provides standardized documentation export and audit trail functionality per Appendix 11 -->

<div class="assessment-outcomes-integration" id="assessment-outcomes-integration">

  <!-- Export and Documentation Section -->
  <div class="outcomes-export-section">
    <div class="export-header">
      <h4>Assessment documentation and export</h4>
      <p class="export-description">Generate framework-compliant documentation forms and audit trails per Appendix 11 requirements.</p>
    </div>

    <div class="export-options">

      <!-- Assessment Outcome Forms -->
      <div class="export-option-group">
        <h5>
          <span class="export-icon">📋</span>
          Assessment outcome documentation
        </h5>
        <div class="export-buttons">
          <button class="export-btn primary" onclick="exportAssessmentOutcome()" id="export-outcome-btn">
            <span class="btn-icon">📄</span>
            Export Assessment Outcome Form
          </button>
          <button class="export-btn secondary" onclick="exportDecisionRecord()" id="export-decision-btn">
            <span class="btn-icon">⚖️</span>
            Export Decision Record
          </button>
          <button class="export-btn secondary" onclick="exportAuditTrail()" id="export-audit-btn">
            <span class="btn-icon">🔍</span>
            Export Audit Trail
          </button>
        </div>
        <div class="export-note">
          <small>Generates standardized forms per Appendix 11 templates with assessment data pre-populated</small>
        </div>
      </div>

      <!-- Compliance Documentation -->
      <div class="export-option-group">
        <h5>
          <span class="export-icon">✅</span>
          Compliance documentation
        </h5>
        <div class="export-buttons">
          <button class="export-btn primary" onclick="exportComplianceReport()" id="export-compliance-btn">
            <span class="btn-icon">📊</span>
            Export Compliance Report
          </button>
          <button class="export-btn secondary" onclick="exportGapAnalysis()" id="export-gaps-btn">
            <span class="btn-icon">🔍</span>
            Export Gap Analysis
          </button>
          <button class="export-btn secondary" onclick="exportRecommendations()" id="export-recommendations-btn">
            <span class="btn-icon">💡</span>
            Export Recommendations Report
          </button>
        </div>
        <div class="export-note">
          <small>Comprehensive compliance status and recommendations for framework adherence</small>
        </div>
      </div>

      <!-- Quality Assurance Documentation -->
      <div class="export-option-group">
        <h5>
          <span class="export-icon">🎯</span>
          Quality assurance documentation
        </h5>
        <div class="export-buttons">
          <button class="export-btn primary" onclick="exportQualityReport()" id="export-quality-btn">
            <span class="btn-icon">📈</span>
            Export Quality Assessment Report
          </button>
          <button class="export-btn secondary" onclick="exportReviewChecklist()" id="export-review-btn">
            <span class="btn-icon">☑️</span>
            Export Peer Review Checklist
          </button>
          <button class="export-btn secondary" onclick="exportValidationReport()" id="export-validation-btn">
            <span class="btn-icon">🔬</span>
            Export Validation Report
          </button>
        </div>
        <div class="export-note">
          <small>Quality assurance documentation and expert review templates</small>
        </div>
      </div>

    </div>
  </div>

  <!-- Documentation Templates Access -->
  <div class="templates-access-section">
    <div class="templates-header">
      <h4>Assessment templates and forms</h4>
      <p class="templates-description">Access standardized assessment documentation templates from Appendix 11.</p>
    </div>

    <div class="template-categories">

      <!-- Form Templates -->
      <div class="template-category">
        <h6>Documentation forms</h6>
        <div class="template-links">
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#use-case-forms" class="template-link">
            <span class="link-icon">📋</span>
            Use Case Assessment Forms
          </a>
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#impact-forms" class="template-link">
            <span class="link-icon">🎯</span>
            Impact Assessment Forms
          </a>
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#technical-forms" class="template-link">
            <span class="link-icon">🔧</span>
            Technical Assessment Forms
          </a>
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#safety-forms" class="template-link">
            <span class="link-icon">🛡️</span>
            Safety Assessment Forms
          </a>
        </div>
      </div>

      <!-- Process Documentation -->
      <div class="template-category">
        <h6>Process documentation</h6>
        <div class="template-links">
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#decision-records" class="template-link">
            <span class="link-icon">⚖️</span>
            Decision Record Templates
          </a>
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#audit-trail" class="template-link">
            <span class="link-icon">🔍</span>
            Audit Trail Documentation
          </a>
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#quality-assurance" class="template-link">
            <span class="link-icon">✅</span>
            Quality Assurance Checklists
          </a>
          <a href="../../resources/appendices/assessment-outcomes/AssessmentOutcomes.en-US.webpage.copy.html#storage-archiving" class="template-link">
            <span class="link-icon">🗄️</span>
            Storage and Archiving Guidelines
          </a>
        </div>
      </div>

    </div>
  </div>

  <!-- Assessment History and Tracking -->
  <div class="assessment-tracking-section">
    <div class="tracking-header">
      <h4>Assessment history and tracking</h4>
      <p class="tracking-description">Track assessment progress and maintain documentation history for audit purposes.</p>
    </div>

    <div class="tracking-status">
      <div class="status-grid">

        <div class="status-item">
          <div class="status-icon">📊</div>
          <div class="status-info">
            <div class="status-label">Assessment Progress</div>
            <div class="status-value" id="assessment-progress">0%</div>
          </div>
        </div>

        <div class="status-item">
          <div class="status-icon">📝</div>
          <div class="status-info">
            <div class="status-label">Documents Generated</div>
            <div class="status-value" id="documents-count">0</div>
          </div>
        </div>

        <div class="status-item">
          <div class="status-icon">✅</div>
          <div class="status-info">
            <div class="status-label">Compliance Status</div>
            <div class="status-value" id="compliance-status">In Progress</div>
          </div>
        </div>

        <div class="status-item">
          <div class="status-icon">🔄</div>
          <div class="status-info">
            <div class="status-label">Last Updated</div>
            <div class="status-value" id="last-updated">-</div>
          </div>
        </div>

      </div>
    </div>

    <div class="tracking-actions">
      <button class="tracking-btn" onclick="viewAssessmentHistory()" id="view-history-btn">
        <span class="btn-icon">📋</span>
        View Assessment History
      </button>
      <button class="tracking-btn" onclick="saveAssessmentSnapshot()" id="save-snapshot-btn">
        <span class="btn-icon">💾</span>
        Save Assessment Snapshot
      </button>
      <button class="tracking-btn" onclick="generateComprehensiveReport()" id="comprehensive-report-btn">
        <span class="btn-icon">📄</span>
        Generate Comprehensive Report
      </button>
    </div>
  </div>

</div>

<!-- Assessment Outcomes Integration Styles -->
<style>
.assessment-outcomes-integration {
  background: #f8f9fa;
  border-radius: 15px;
  padding: 30px;
  margin: 40px 0;
  border-left: 5px solid #28a745;
}

.outcomes-export-section,
.templates-access-section,
.assessment-tracking-section {
  margin-bottom: 30px;
}

.export-header,
.templates-header,
.tracking-header {
  margin-bottom: 20px;
}

.export-header h4,
.templates-header h4,
.tracking-header h4 {
  color: #28a745;
  margin-bottom: 8px;
  font-weight: 600;
}

.export-description,
.templates-description,
.tracking-description {
  color: #6c757d;
  font-size: 0.95rem;
  margin: 0;
}

.export-option-group {
  background: white;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid #dee2e6;
}

.export-option-group h5 {
  color: #495057;
  margin-bottom: 15px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
}

.export-icon {
  font-size: 1.2rem;
}

.export-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 10px;
}

.export-btn {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.export-btn.secondary {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
}

.export-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

.export-btn.primary:hover {
  background: linear-gradient(135deg, #1e7e34 0%, #17a2b8 100%);
}

.export-btn.secondary:hover {
  background: linear-gradient(135deg, #0056b3 0%, #003d82 100%);
}

.export-note {
  margin-top: 5px;
}

.export-note small {
  color: #6c757d;
  font-style: italic;
}

.template-categories {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.template-category {
  background: white;
  border-radius: 10px;
  padding: 20px;
  border: 1px solid #dee2e6;
}

.template-category h6 {
  color: #495057;
  margin-bottom: 15px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.85rem;
}

.template-links {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.template-link {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 6px;
  text-decoration: none;
  color: #007bff;
  font-weight: 500;
  transition: all 0.3s ease;
  border-left: 3px solid #007bff;
}

.template-link:hover {
  background: #e7f3ff;
  text-decoration: none;
  color: #0056b3;
  transform: translateX(5px);
}

.link-icon {
  font-size: 1.1rem;
}

.tracking-status {
  background: white;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  border: 1px solid #dee2e6;
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}

.status-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #28a745;
}

.status-icon {
  font-size: 1.5rem;
}

.status-info {
  flex: 1;
}

.status-label {
  font-size: 0.85rem;
  color: #6c757d;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-value {
  font-size: 1.1rem;
  color: #495057;
  font-weight: 600;
  margin-top: 2px;
}

.tracking-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.tracking-btn {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.tracking-btn:hover {
  background: linear-gradient(135deg, #495057 0%, #343a40 100%);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

.btn-icon {
  font-size: 0.9rem;
}

@media (max-width: 768px) {
  .assessment-outcomes-integration {
    padding: 20px;
  }

  .export-buttons,
  .tracking-actions {
    flex-direction: column;
  }

  .export-btn,
  .tracking-btn {
    justify-content: center;
  }

  .template-categories {
    grid-template-columns: 1fr;
  }

  .status-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<!-- Assessment Outcomes Integration JavaScript -->
<script>
class AssessmentOutcomesIntegration {
  constructor() {
    this.assessmentData = {};
    this.documentHistory = [];
    this.init();
  }

  init() {
    this.updateTrackingStatus();
    this.setupEventListeners();
  }

  setupEventListeners() {
    // Update tracking when form data changes
    document.addEventListener('change', (e) => {
      if (e.target.form) {
        this.updateTrackingStatus();
      }
    });
  }

  updateTrackingStatus() {
    // Calculate assessment progress
    const forms = document.querySelectorAll('form');
    let totalFields = 0;
    let completedFields = 0;

    forms.forEach(form => {
      const inputs = form.querySelectorAll('input, textarea, select');
      inputs.forEach(input => {
        totalFields++;
        if (this.isFieldCompleted(input)) {
          completedFields++;
        }
      });
    });

    const progress = totalFields > 0 ? Math.round((completedFields / totalFields) * 100) : 0;

    // Update UI elements
    const progressElement = document.getElementById('assessment-progress');
    const documentsElement = document.getElementById('documents-count');
    const complianceElement = document.getElementById('compliance-status');
    const lastUpdatedElement = document.getElementById('last-updated');

    if (progressElement) progressElement.textContent = `${progress}%`;
    if (documentsElement) documentsElement.textContent = this.documentHistory.length;
    if (complianceElement) {
      complianceElement.textContent = progress >= 100 ? 'Complete' :
                                    progress >= 75 ? 'Near Complete' :
                                    progress >= 50 ? 'In Progress' : 'Started';
    }
    if (lastUpdatedElement) lastUpdatedElement.textContent = new Date().toLocaleDateString();

    // Update export button states
    this.updateExportButtonStates(progress);
  }

  isFieldCompleted(input) {
    switch (input.type) {
      case 'radio':
        return document.querySelector(`input[name="${input.name}"]:checked`) !== null;
      case 'checkbox':
        const checkboxes = document.querySelectorAll(`input[name="${input.name}"]`);
        return Array.from(checkboxes).some(cb => cb.checked);
      default:
        return input.value.trim() !== '';
    }
  }

  updateExportButtonStates(progress) {
    const exportButtons = document.querySelectorAll('.export-btn');
    exportButtons.forEach(btn => {
      btn.disabled = progress < 25; // Require at least 25% completion
      if (btn.disabled) {
        btn.style.opacity = '0.5';
        btn.style.cursor = 'not-allowed';
      } else {
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
      }
    });
  }

  collectAssessmentData() {
    const data = {
      metadata: {
        toolType: this.getAssessmentToolType(),
        timestamp: new Date().toISOString(),
        version: '1.0',
        frameworkVersion: 'SynD-DGF v1.0'
      },
      responses: {},
      progress: {},
      compliance: {}
    };

    // Collect form responses
    const forms = document.querySelectorAll('form');
    forms.forEach((form, index) => {
      const formData = new FormData(form);
      const formResponses = {};

      for (let [key, value] of formData.entries()) {
        if (formResponses[key]) {
          // Handle multiple values (checkboxes)
          if (Array.isArray(formResponses[key])) {
            formResponses[key].push(value);
          } else {
            formResponses[key] = [formResponses[key], value];
          }
        } else {
          formResponses[key] = value;
        }
      }

      data.responses[`form_${index}`] = formResponses;
    });

    return data;
  }

  getAssessmentToolType() {
    const title = document.title.toLowerCase();
    if (title.includes('impact')) return 'Impact Assessment';
    if (title.includes('risk')) return 'Risk Evaluation';
    if (title.includes('quality')) return 'Quality Metrics';
    if (title.includes('compliance')) return 'Compliance Checklist';
    if (title.includes('use case')) return 'Use Case Assessment';
    return 'Assessment Tool';
  }

  generateDocument(type, format = 'pdf') {
    const data = this.collectAssessmentData();

    // Add to document history
    this.documentHistory.push({
      type: type,
      format: format,
      timestamp: new Date().toISOString(),
      data: data
    });

    // Update tracking
    this.updateTrackingStatus();

    return data;
  }
}

// Export functions for button callbacks
function exportAssessmentOutcome() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Assessment Outcome Form');

  // Generate and download document
  generateAssessmentDocument('assessment-outcome', data);
}

function exportDecisionRecord() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Decision Record');

  generateAssessmentDocument('decision-record', data);
}

function exportAuditTrail() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Audit Trail');

  generateAssessmentDocument('audit-trail', data);
}

function exportComplianceReport() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Compliance Report');

  generateAssessmentDocument('compliance-report', data);
}

function exportGapAnalysis() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Gap Analysis');

  generateAssessmentDocument('gap-analysis', data);
}

function exportRecommendations() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Recommendations Report');

  generateAssessmentDocument('recommendations', data);
}

function exportQualityReport() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Quality Assessment Report');

  generateAssessmentDocument('quality-report', data);
}

function exportReviewChecklist() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Peer Review Checklist');

  generateAssessmentDocument('review-checklist', data);
}

function exportValidationReport() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Validation Report');

  generateAssessmentDocument('validation-report', data);
}

function viewAssessmentHistory() {
  // Implementation for viewing assessment history
  console.log('Opening assessment history...');
}

function saveAssessmentSnapshot() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Assessment Snapshot');

  // Save to local storage
  localStorage.setItem(`synd-dgf-snapshot-${Date.now()}`, JSON.stringify(data));

  alert('Assessment snapshot saved successfully!');
}

function generateComprehensiveReport() {
  const integration = new AssessmentOutcomesIntegration();
  const data = integration.generateDocument('Comprehensive Report');

  generateAssessmentDocument('comprehensive-report', data);
}

function generateAssessmentDocument(type, data) {
  // Create a comprehensive document with framework-compliant formatting
  const content = formatAssessmentDocument(type, data);

  // Create and download the document
  const blob = new Blob([content], { type: 'text/html' });
  const url = URL.createObjectURL(blob);

  const link = document.createElement('a');
  link.href = url;
  link.download = `${type}-${data.metadata.timestamp.split('T')[0]}.html`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  URL.revokeObjectURL(url);
}

function formatAssessmentDocument(type, data) {
  return `
<!DOCTYPE html>
<html>
<head>
    <title>SynD-DGF ${type} - ${data.metadata.timestamp.split('T')[0]}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .header { border-bottom: 2px solid #28a745; padding-bottom: 20px; margin-bottom: 30px; }
        .section { margin-bottom: 30px; padding: 20px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .field { margin-bottom: 15px; }
        .label { font-weight: bold; color: #495057; }
        .value { margin-left: 20px; color: #333; }
        .metadata { background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>SynD-DGF ${type}</h1>
        <p><strong>Generated:</strong> ${new Date(data.metadata.timestamp).toLocaleString()}</p>
        <p><strong>Tool:</strong> ${data.metadata.toolType}</p>
        <p><strong>Framework Version:</strong> ${data.metadata.frameworkVersion}</p>
    </div>

    <div class="metadata">
        <h2>Document Information</h2>
        <div class="field">
            <div class="label">Document Type:</div>
            <div class="value">${type}</div>
        </div>
        <div class="field">
            <div class="label">Assessment Tool:</div>
            <div class="value">${data.metadata.toolType}</div>
        </div>
        <div class="field">
            <div class="label">Generation Timestamp:</div>
            <div class="value">${new Date(data.metadata.timestamp).toLocaleString()}</div>
        </div>
    </div>

    <div class="section">
        <h2>Assessment Responses</h2>
        ${formatResponses(data.responses)}
    </div>

    <div class="section">
        <h2>Framework Compliance</h2>
        <p>This document has been generated in accordance with the SynD-DGF Appendix 11 assessment outcomes documentation requirements.</p>
    </div>

    <div class="footer">
        <p><em>Generated by SynD-DGF Assessment Tools - ${new Date().getFullYear()}</em></p>
    </div>
</body>
</html>`;
}

function formatResponses(responses) {
  let html = '';

  Object.entries(responses).forEach(([formKey, formData]) => {
    html += `<h3>${formKey.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}</h3>`;

    Object.entries(formData).forEach(([field, value]) => {
      html += `
        <div class="field">
            <div class="label">${field.replace(/[-_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}:</div>
            <div class="value">${Array.isArray(value) ? value.join(', ') : value}</div>
        </div>`;
    });
  });

  return html;
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  new AssessmentOutcomesIntegration();
});
</script>