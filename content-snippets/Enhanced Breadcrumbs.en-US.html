<!-- Enhanced Breadcrumbs with Framework Context -->
<nav class="enhanced-breadcrumbs" aria-label="Breadcrumb navigation">
  <div class="breadcrumb-container">
    
    <!-- Framework Step Context -->
    <div class="framework-context" id="framework-context" style="display: none;">
      <div class="context-header">
        <span class="context-icon">📋</span>
        <span class="context-title">Framework Step</span>
      </div>
      <div class="step-progress">
        <div class="step-indicator" data-step="1">
          <span class="step-number">1</span>
          <span class="step-name">Use Case</span>
        </div>
        <div class="step-indicator" data-step="2">
          <span class="step-number">2</span>
          <span class="step-name">Source Data</span>
        </div>
        <div class="step-indicator" data-step="3">
          <span class="step-number">3</span>
          <span class="step-name">Generate Data</span>
        </div>
        <div class="step-indicator" data-step="4">
          <span class="step-number">4</span>
          <span class="step-name">Risk Assessment</span>
        </div>
        <div class="step-indicator" data-step="5">
          <span class="step-number">5</span>
          <span class="step-name">Risk Management</span>
        </div>
      </div>
    </div>

    <!-- Standard Breadcrumbs -->
    <ol class="breadcrumb-list">
      <li class="breadcrumb-item">
        <a href="/" class="breadcrumb-link">
          <span class="breadcrumb-icon">🏠</span>
          <span class="breadcrumb-text">Home</span>
        </a>
      </li>
      
      <!-- Dynamic breadcrumbs will be inserted here by JavaScript -->
      <li class="breadcrumb-item current" id="current-page">
        <span class="breadcrumb-text">{{ page.title | h }}</span>
      </li>
    </ol>

    <!-- Page Actions -->
    <div class="page-actions">
      <button class="action-button" onclick="printPage()" title="Print this page">
        <span class="action-icon">🖨️</span>
      </button>
      <button class="action-button" onclick="sharePage()" title="Share this page">
        <span class="action-icon">📤</span>
      </button>
      <button class="action-button" onclick="bookmarkPage()" title="Bookmark this page">
        <span class="action-icon">🔖</span>
      </button>
    </div>
  </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const breadcrumbList = document.querySelector('.breadcrumb-list');
    const currentPageItem = document.getElementById('current-page');
    const frameworkContext = document.getElementById('framework-context');
    
    // Framework step mapping
    const frameworkSteps = {
        '/framework-overview': { section: 'framework', step: 0, title: 'Framework Overview' },
        '/step-1-use-case-assessment': { section: 'framework', step: 1, title: 'Step 1: Assess Use Case' },
        '/step-2-assess-source-data': { section: 'framework', step: 2, title: 'Step 2: Assess Source Data' },
        '/step-3-generate-synthetic-data': { section: 'framework', step: 3, title: 'Step 3: Generate Synthetic Data' },
        '/step-4-assess-reidentification-risks': { section: 'framework', step: 4, title: 'Step 4: Assess Re-identification Risks' },
        '/step-5-manage-residual-risks': { section: 'framework', step: 5, title: 'Step 5: Manage Residual Risks' }
    };
    
    // Decision support mapping
    const decisionSupportPages = {
        '/decision-support-overview': { section: 'decision-support', title: 'Decision Support Overview' },
        '/complex-scenarios-navigator': { section: 'decision-support', title: 'Complex Scenarios Navigator' },
        '/legal-pathways-wizard': { section: 'decision-support', title: 'Legal Pathways Wizard' },
        '/risk-mitigation-planner': { section: 'decision-support', title: 'Risk Mitigation Planner' },
        '/jurisdiction-mapper': { section: 'decision-support', title: 'Jurisdiction Mapper' }
    };
    
    // Assessment tools mapping
    const assessmentPages = {
        '/assessment-tools': { section: 'assessment', title: 'Assessment Tools Overview' },
        '/use-case-assessment-tool': { section: 'assessment', title: 'Use Case Assessment Tool' },
        '/risk-evaluation-tool': { section: 'assessment', title: 'Risk Evaluation Tool' },
        '/compliance-checklist-tool': { section: 'assessment', title: 'Compliance Checklist Tool' },
        '/quality-metrics-tool': { section: 'assessment', title: 'Quality Metrics Tool' }
    };
    
    // Resources mapping
    const resourcePages = {
        '/resources': { section: 'resources', title: 'Resources Overview' }
    };
    
    function buildBreadcrumbs() {
        const pathSegments = currentPath.split('/').filter(segment => segment);
        let breadcrumbs = [];
        
        // Check if this is a framework step
        if (frameworkSteps[currentPath]) {
            const stepInfo = frameworkSteps[currentPath];
            breadcrumbs.push({
                url: '/framework-overview',
                text: 'Framework',
                icon: '📋'
            });
            
            if (stepInfo.step > 0) {
                breadcrumbs.push({
                    url: currentPath,
                    text: stepInfo.title,
                    icon: stepInfo.step.toString(),
                    current: true
                });
            }
            
            // Show framework context
            showFrameworkContext(stepInfo.step);
        }
        // Check if this is a decision support page
        else if (decisionSupportPages[currentPath]) {
            breadcrumbs.push({
                url: '/decision-support-overview',
                text: 'Decision Support',
                icon: '🛠️'
            });
            
            if (currentPath !== '/decision-support-overview') {
                breadcrumbs.push({
                    url: currentPath,
                    text: decisionSupportPages[currentPath].title,
                    icon: getDecisionSupportIcon(currentPath),
                    current: true
                });
            }
        }
        // Check if this is an assessment page
        else if (assessmentPages[currentPath]) {
            breadcrumbs.push({
                url: '/assessment-tools',
                text: 'Assessment Tools',
                icon: '📋'
            });
            
            if (currentPath !== '/assessment-tools') {
                breadcrumbs.push({
                    url: currentPath,
                    text: assessmentPages[currentPath].title,
                    icon: '✅',
                    current: true
                });
            }
        }
        // Check if this is a resources page
        else if (currentPath.startsWith('/resources')) {
            breadcrumbs.push({
                url: '/resources',
                text: 'Resources',
                icon: '📚'
            });
            
            if (currentPath !== '/resources') {
                // Handle sub-resource pages
                const subPath = currentPath.replace('/resources/', '');
                breadcrumbs.push({
                    url: currentPath,
                    text: formatPageTitle(subPath),
                    icon: '📄',
                    current: true
                });
            }
        }
        
        // Insert breadcrumbs into DOM
        insertBreadcrumbs(breadcrumbs);
    }
    
    function insertBreadcrumbs(breadcrumbs) {
        // Remove existing dynamic breadcrumbs
        const existingBreadcrumbs = breadcrumbList.querySelectorAll('.dynamic-breadcrumb');
        existingBreadcrumbs.forEach(item => item.remove());
        
        // Insert new breadcrumbs before current page
        breadcrumbs.forEach((crumb, index) => {
            if (!crumb.current) {
                const breadcrumbItem = createBreadcrumbItem(crumb);
                breadcrumbList.insertBefore(breadcrumbItem, currentPageItem);
            } else {
                // Update current page
                currentPageItem.querySelector('.breadcrumb-text').textContent = crumb.text;
            }
        });
    }
    
    function createBreadcrumbItem(crumb) {
        const li = document.createElement('li');
        li.className = 'breadcrumb-item dynamic-breadcrumb';
        
        const link = document.createElement('a');
        link.href = crumb.url;
        link.className = 'breadcrumb-link';
        
        const icon = document.createElement('span');
        icon.className = 'breadcrumb-icon';
        icon.textContent = crumb.icon;
        
        const text = document.createElement('span');
        text.className = 'breadcrumb-text';
        text.textContent = crumb.text;
        
        link.appendChild(icon);
        link.appendChild(text);
        li.appendChild(link);
        
        return li;
    }
    
    function showFrameworkContext(currentStep) {
        frameworkContext.style.display = 'block';
        
        // Update step indicators
        const stepIndicators = frameworkContext.querySelectorAll('.step-indicator');
        stepIndicators.forEach((indicator, index) => {
            const stepNumber = index + 1;
            indicator.classList.remove('completed', 'current', 'upcoming');
            
            if (stepNumber < currentStep) {
                indicator.classList.add('completed');
            } else if (stepNumber === currentStep) {
                indicator.classList.add('current');
            } else {
                indicator.classList.add('upcoming');
            }
        });
    }
    
    function getDecisionSupportIcon(path) {
        const icons = {
            '/complex-scenarios-navigator': '🧭',
            '/legal-pathways-wizard': '⚖️',
            '/risk-mitigation-planner': '🛡️',
            '/jurisdiction-mapper': '🗺️'
        };
        return icons[path] || '🛠️';
    }
    
    function formatPageTitle(path) {
        return path.split('-').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1)
        ).join(' ');
    }
    
    // Initialize breadcrumbs
    buildBreadcrumbs();
});

// Page action functions
function printPage() {
    window.print();
}

function sharePage() {
    if (navigator.share) {
        navigator.share({
            title: document.title,
            url: window.location.href
        });
    } else {
        // Fallback: copy URL to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Page URL copied to clipboard');
        });
    }
}

function bookmarkPage() {
    // Store bookmark in localStorage
    const bookmark = {
        title: document.title,
        url: window.location.href,
        timestamp: new Date().toISOString()
    };
    
    let bookmarks = JSON.parse(localStorage.getItem('synd-bookmarks') || '[]');
    bookmarks.push(bookmark);
    localStorage.setItem('synd-bookmarks', JSON.stringify(bookmarks));
    
    alert('Page bookmarked successfully');
}
</script>

<style>
.enhanced-breadcrumbs {
    background: #f8f9fa;
    border-bottom: 1px solid #e0e0e0;
    padding: 1rem 0;
    margin-bottom: 2rem;
}

.breadcrumb-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
}

.framework-context {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.context-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    color: #007bff;
    font-weight: 600;
}

.context-icon {
    font-size: 1.2rem;
}

.step-progress {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.step-indicator {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.step-indicator.completed {
    background: #e8f5e8;
    color: #28a745;
}

.step-indicator.current {
    background: #e7f3ff;
    color: #007bff;
    font-weight: bold;
    transform: scale(1.05);
}

.step-indicator.upcoming {
    background: #f8f9fa;
    color: #6c757d;
}

.step-number {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: currentColor;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
}

.step-indicator.upcoming .step-number {
    background: #e0e0e0;
    color: #6c757d;
}

.step-name {
    font-size: 0.75rem;
    text-align: center;
    max-width: 60px;
    line-height: 1.2;
}

.breadcrumb-list {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
    flex-wrap: wrap;
}

.breadcrumb-item {
    display: flex;
    align-items: center;
}

.breadcrumb-item:not(:last-child)::after {
    content: '›';
    margin-left: 0.5rem;
    color: #6c757d;
    font-size: 1.2rem;
}

.breadcrumb-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    color: #007bff;
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.breadcrumb-link:hover {
    background: #e7f3ff;
    color: #0056b3;
    text-decoration: none;
}

.breadcrumb-icon {
    font-size: 1rem;
}

.breadcrumb-text {
    font-size: 0.9rem;
    font-weight: 500;
}

.breadcrumb-item.current .breadcrumb-text {
    color: #495057;
    font-weight: 600;
}

.page-actions {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
}

.action-button {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 0.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.action-button:hover {
    background: #f8f9fa;
    border-color: #007bff;
    transform: translateY(-1px);
}

.action-button:focus {
    outline: 2px solid #007bff;
    outline-offset: 2px;
}

.action-icon {
    font-size: 1rem;
}

@media (max-width: 768px) {
    .breadcrumb-container {
        padding: 0 1rem;
    }
    
    .breadcrumb-list {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
    }
    
    .breadcrumb-item:not(:last-child)::after {
        display: none;
    }
    
    .step-progress {
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .step-indicator {
        min-width: 60px;
    }
    
    .page-actions {
        margin-left: 0;
        margin-top: 1rem;
    }
}

@media (max-width: 480px) {
    .step-progress {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
    }
    
    .breadcrumb-text {
        font-size: 0.8rem;
    }
}
</style>